
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>About the *Modern C++ Kafka API*</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css" integrity="sha384-SI27wrMjH3ZZ89r4o+fGIJtnzkAnFs3E4qz9DIYioCQ5l9Rd/7UAa8DHcaL8jkWt" crossorigin="anonymous">
    <style>
      pre { background: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; padding: 0.6em 1em; }
      h1,h2 { margin-top: 1em; }
      div.navbar { padding: 8px 0; }
      div.toc { float: right; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="about-the-modern-c-kafka-api"><a class="toclink" href="#about-the-modern-c-kafka-api">About the <em>Modern C++ Kafka API</em></a></h1>
<p><img alt="Lifecycle Active" src="https://badgen.net/badge/Lifecycle/Active/green" />  </p>
<h2 id="introduction"><a class="toclink" href="#introduction">Introduction</a></h2>
<p>The <a href="http://opensource.morganstanley.com/modern-cpp-kafka/doxygen/annotated.html">Modern C++ Kafka API</a> is a layer of C++ wrapper based on <a href="https://github.com/edenhill/librdkafka">librdkafka</a> (the C part), with high quality, but more friendly to users.</p>
<ul>
<li>By now, <a href="https://github.com/morganstanley/modern-cpp-kafka">modern-cpp-kafka</a> is compatible with <a href="https://github.com/edenhill/librdkafka/releases/tag/v1.9.0">librdkafka v1.9.0</a>.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">KAFKA</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">registered</span><span class="w"> </span><span class="n">trademark</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">Foundation</span><span class="w"> </span><span class="k">and</span><span class="w"></span>

<span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">licensed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">modern</span><span class="o">-</span><span class="n">cpp</span><span class="o">-</span><span class="n">kafka</span><span class="p">.</span><span class="w"> </span><span class="n">modern</span><span class="o">-</span><span class="n">cpp</span><span class="o">-</span><span class="n">kafka</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"></span>

<span class="n">affiliation</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">endorsed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Apache</span><span class="w"> </span><span class="n">Software</span><span class="w"> </span><span class="n">Foundation</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<h2 id="why-its-here"><a class="toclink" href="#why-its-here">Why it's here</a></h2>
<p>The <strong><em>librdkafka</em></strong> is a robust high performance C/C++ library, widely used and well maintained.</p>
<p>Unfortunately, to maintain C++98 compatibility, the C++ interface of <strong><em>librdkafka</em></strong> is not quite object-oriented or user-friendly.</p>
<p>Since C++ is evolving quickly, we want to take advantage of new C++ features, thus make the life easier for developers. And this led us to create a new C++ API for Kafka clients.</p>
<p>Eventually, we worked out the <strong><em>modern-cpp-kafka</em></strong>, -- a header-only library that uses idiomatic C++ features to provide a safe, efficient and easy to use way of producing and consuming Kafka messages.</p>
<h2 id="features"><a class="toclink" href="#features">Features</a></h2>
<ul>
<li>
<p>Header-only</p>
<ul>
<li>Easy to deploy, and no extra library required to link</li>
</ul>
</li>
<li>
<p>Ease of Use</p>
<ul>
<li>
<p>Interface/Naming matches the Java API</p>
</li>
<li>
<p>Object-oriented</p>
</li>
<li>
<p>RAII is used for lifetime management</p>
</li>
<li>
<p><strong><em>librdkafka</em></strong>'s polling and queue management is now hidden</p>
</li>
</ul>
</li>
<li>
<p>Robust</p>
<ul>
<li>
<p>Verified with kinds of test cases, which cover many abnormal scenarios (edge cases)</p>
<ul>
<li>
<p>Stability test with unstable brokers</p>
</li>
<li>
<p>Memory leak check for failed client with in-flight messages</p>
</li>
<li>
<p>Client failure and taking over, etc.</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Efficient</p>
<ul>
<li>
<p>No extra performance cost (No deep copy introduced internally)</p>
</li>
<li>
<p>Much better (2~4 times throughput) performance result than those native language (Java/Scala) implementation, in most commonly used cases (message size: 256 B ~ 2 KB)</p>
</li>
</ul>
</li>
</ul>
<h2 id="build"><a class="toclink" href="#build">Build</a></h2>
<ul>
<li>
<p>No need to build for installation</p>
</li>
<li>
<p>To build its <code>tools</code>/<code>tests</code>/<code>examples</code>, you should</p>
<ul>
<li>
<p>Specify library locations with environment variables</p>
<ul>
<li>
<p><code>LIBRDKAFKA_ROOT</code>                 -- <strong><em>librdkafka</em></strong> headers and libraries</p>
</li>
<li>
<p><code>GTEST_ROOT</code>                      -- <strong><em>googletest</em></strong> headers and libraries</p>
</li>
<li>
<p><code>BOOST_ROOT</code>                      -- <strong><em>boost</em></strong> headers and libraries</p>
</li>
<li>
<p><code>SASL_LIBRARYDIR</code>/<code>SASL_LIBRARY</code>  -- if SASL connection support is wanted</p>
</li>
<li>
<p><code>RAPIDJSON_INCLUDE_DIRS</code>          -- <code>addons/KafkaMetrics</code> requires <strong>rapidjson</strong> headers</p>
</li>
</ul>
</li>
<li>
<p>Create an empty directory for the build, and <code>cd</code> to it</p>
</li>
<li>
<p>Build commands</p>
<ul>
<li>
<p>Type <code>cmake path-to-project-root</code></p>
</li>
<li>
<p>Type <code>make</code> (could follow build options with <code>-D</code>)</p>
<ul>
<li>
<p><code>BUILD_OPTION_USE_ASAN=ON</code>      -- Use Address Sanitizer</p>
</li>
<li>
<p><code>BUILD_OPTION_USE_TSAN=ON</code>      -- Use Thread Sanitizer</p>
</li>
<li>
<p><code>BUILD_OPTION_USE_UBSAN=ON</code>     -- Use Undefined Behavior Sanitizer</p>
</li>
<li>
<p><code>BUILD_OPTION_CLANG_TIDY=ON</code>    -- Enable clang-tidy checking</p>
</li>
<li>
<p><code>BUILD_OPTION_GEN_DOC=ON</code>       -- Generate documentation as well</p>
</li>
<li>
<p><code>BUILD_OPTION_DOC_ONLY=ON</code>      -- Only generate documentation</p>
</li>
<li>
<p><code>BUILD_OPTION_GEN_COVERAGE=ON</code>  -- Generate test coverage, only support by clang currently</p>
</li>
</ul>
</li>
<li>
<p>Type <code>make install</code></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="install"><a class="toclink" href="#install">Install</a></h2>
<ul>
<li>
<p>Include the <code>include/kafka</code> directory in your project</p>
</li>
<li>
<p>To work together with <strong><em>modern-cpp-kafka</em></strong> API, the compiler should support</p>
<ul>
<li>
<p>Option 1: C++17</p>
</li>
<li>
<p>Option 2: C++14 (with pre-requirements)</p>
<ul>
<li>
<p>Need <strong><em>boost</em></strong> headers (for <code>boost::optional</code>)</p>
</li>
<li>
<p>GCC only (with optimization, e.g. -O2)</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="how-to-run-tests"><a class="toclink" href="#how-to-run-tests">How to Run Tests</a></h2>
<ul>
<li>
<p>Unit test (<code>tests/unit</code>)</p>
<ul>
<li>The test could be run with no Kafka cluster depolyed</li>
</ul>
</li>
<li>
<p>Integration test (<code>tests/integration</code>)</p>
<ul>
<li>
<p>The test should be run with Kafka cluster depolyed</p>
</li>
<li>
<p>The environment variable <code>KAFKA_BROKER_LIST</code> should be set</p>
<ul>
<li>E.g. <code>export KAFKA_BROKER_LIST=127.0.0.1:29091,127.0.0.1:29092,127.0.0.1:29093</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Robustness test (<code>tests/robustness</code>)</p>
<ul>
<li>
<p>The test should be run with Kafka cluster depolyed locally</p>
</li>
<li>
<p>The environment variable <code>KAFKA_BROKER_LIST</code> should be set</p>
</li>
<li>
<p>The environment variable <code>KAFKA_BROKER_PIDS</code> should be set</p>
<ul>
<li>
<p>Make sure the test runner gets the privilege to stop/resume the pids</p>
</li>
<li>
<p>E.g. <code>export KAFKA_BROKER_PIDS=61567,61569,61571</code></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Additional settings for clients</p>
<ul>
<li>
<p>The environment variable <code>KAFKA_CLIENT_ADDITIONAL_SETTINGS</code> could be used for customized test environment</p>
<ul>
<li>
<p>Especially for Kafka cluster with SASL(or SSL) connections</p>
</li>
<li>
<p>E.g. <code>export KAFKA_CLIENT_ADDITIONAL_SETTINGS="security.protocol=SASL_PLAINTEXT;sasl.kerberos.service.name=...;sasl.kerberos.keytab=...;sasl.kerberos.principal=..."</code></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="to-start"><a class="toclink" href="#to-start">To Start</a></h2>
<ul>
<li>
<p>Tutorial</p>
<ul>
<li>
<p>Confluent Blog <a href="https://www.confluent.io/blog/modern-cpp-kafka-api-for-safe-easy-messaging">Debuting a Modern C++ API for Apache Kafka</a></p>
</li>
<li>
<p><a href="markdown/KafkaProducerQuickStart.html">KafkaProducer Quick Start</a></p>
</li>
<li>
<p><a href="markdown/KafkaConsumerQuickStart.html">KafkaConsumer Quick Start</a></p>
</li>
</ul>
</li>
<li>
<p>User's Manual</p>
<ul>
<li>
<p><a href="http://opensource.morganstanley.com/modern-cpp-kafka/doxygen/annotated.html">Kafka Client API</a></p>
</li>
<li>
<p>Kafka Client Properties</p>
<ul>
<li>
<p>In most cases, the <code>Properties</code> settings for <strong><em>modern-cpp-kafka</em></strong> are identical with <a href="https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md">librdkafka configuration</a></p>
</li>
<li>
<p>With following exceptions</p>
<ul>
<li>
<p>KafkaConsumer</p>
<ul>
<li>
<p>Properties with random string as default</p>
<ul>
<li>
<p><code>client.id</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
</ul>
</li>
<li>
<p>More properties than <strong><em>librdkafka</em></strong></p>
<ul>
<li><code>max.poll.records</code> (default: <code>500</code>): The maxmum number of records that a single call to <code>poll()</code> would return</li>
</ul>
</li>
<li>
<p>Property which overrides the one from <strong><em>librdkafka</em></strong></p>
<ul>
<li><code>enable.auto.commit</code> (default: <code>false</code>): To automatically commit the previously polled offsets on each <code>poll</code> operation</li>
</ul>
</li>
<li>
<p>Properties not supposed to be used (internally shadowed by <strong><em>modern-cpp-kafka</em></strong>)</p>
<ul>
<li>
<p><code>enable.auto.offset.store</code></p>
</li>
<li>
<p><code>auto.commit.interval.ms</code></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>KafkaProducer</p>
<ul>
<li>
<p>Properties with random string as default</p>
<ul>
<li><code>client.id</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Log level</p>
<ul>
<li>The default <code>log_level</code> is <code>NOTICE</code> (<code>5</code>) for all these clients</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Test Environment (ZooKeeper/Kafka cluster) Setup</p>
<ul>
<li><a href="https://kafka.apache.org/documentation/#quickstart_startserver">Start the servers</a></li>
</ul>
</li>
</ul>
<h2 id="how-to-achieve-high-availability-performance"><a class="toclink" href="#how-to-achieve-high-availability-performance">How to Achieve High Availability &amp; Performance</a></h2>
<ul>
<li>
<p><a href="markdown/KafkaBrokerConfiguration.html">Kafka Broker Configuration</a></p>
</li>
<li>
<p><a href="markdown/GoodPracticesToUseKafkaProducer.html">Good Practices to Use KafkaProducer</a></p>
</li>
<li>
<p><a href="markdown/GoodPracticesToUseKafkaConsumer.html">Good Practices to Use KafkaConsumer</a></p>
</li>
<li>
<p><a href="markdown/HowToMakeKafkaProducerReliable.html">How to Make KafkaProducer Reliable</a></p>
</li>
</ul>
<h2 id="other-references"><a class="toclink" href="#other-references">Other References</a></h2>
<ul>
<li>
<p>Java API for Kafka clients</p>
<ul>
<li>
<p><a href="https://kafka.apache.org/22/javadoc/org/apache/kafka/clients/producer/package-summary.html">org.apache.kafka.clients.producer</a></p>
</li>
<li>
<p><a href="https://kafka.apache.org/22/javadoc/org/apache/kafka/clients/consumer/package-summary.html">org.apache.kafka.clients.consumer</a></p>
</li>
<li>
<p><a href="https://kafka.apache.org/22/javadoc/org/apache/kafka/clients/admin/package-summary.html">org.apache.kafka.clients.admin</a></p>
</li>
</ul>
</li>
</ul>
      <hr/>
      <footer class="text-center text-muted">
        Generated: 2022. 09. 09
      </footer>
      <hr/>
    </div>
  </body>
</html>